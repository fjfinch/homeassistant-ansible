- id: '1733714968098'
  alias: automation-phone
  description: ''
  triggers:
  - trigger: time
    at: 00:00:00
    id: low
  - trigger: time
    at: input_datetime.datetime_wakeup_time
    id: high
    enabled: true
  - trigger: state
    entity_id:
    - input_boolean.boolean_wakeup_lights
    to: 'on'
    from: 'off'
    id: high
    enabled: false
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - low
    then:
    - action: notify.notify
      metadata: {}
      data:
        message: command_screen_brightness_level
        data:
          command: 8
  - if:
    - condition: trigger
      id:
      - high
    - condition: state
      entity_id: binary_sensor.sun_solar_rising
      state: 'on'
      enabled: false
    - condition: state
      entity_id: input_boolean.boolean_wakeup_lights
      state: 'off'
    then:
    - action: notify.notify
      metadata: {}
      data:
        message: command_screen_brightness_level
        data:
          command: 30
  mode: single
- id: '1741004005554'
  alias: automation-lights-time
  description: ''
  triggers:
  - trigger: template
    value_template: '{% set hours = as_timestamp(states(''sensor.sun_next_dusk''))
      | timestamp_custom(''%H'') | int %}

      {% set min = as_timestamp(states(''sensor.sun_next_dusk'')) | timestamp_custom(''%M'')
      | int %}

      {% set ratio = 6/10 %}

      {{ as_timestamp(now()) | timestamp_custom(''%H:%M'') == (((24-hours-min/60)*ratio+hours+min/60)*60*60)
      | timestamp_custom(''%H:%M'', false) }}'
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: light.lights_livingroom
      attribute: color_mode
      state: color_temp
    - condition: not
      conditions:
      - condition: state
        entity_id: input_text.text_livingroom_lights_state
        state: Color
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          transition: 180
      target:
        entity_id:
        - script.script_livingroom_lights_color_2
  - if:
    - condition: state
      entity_id: light.lights_bedroom
      attribute: color_mode
      state: color_temp
    - condition: not
      conditions:
      - condition: state
        entity_id: input_text.text_bedroom_lights_state
        state: Color
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          transition: 180
      target:
        entity_id: script.script_bedroom_lights_color
  mode: single
- id: '1741088261703'
  alias: automation-lights-morning
  description: ''
  triggers:
  - at: input_datetime.datetime_wakeup_time
    trigger: time
  conditions:
  - condition: state
    entity_id: input_boolean.boolean_wakeup_lights
    state: 'off'
  - condition: state
    entity_id: binary_sensor.bed_presence_c1761c_bed_occupied_either
    state: 'on'
  actions:
  - action: script.turn_on
    metadata: {}
    data:
      variables:
        transition: 1200
    target:
      entity_id: script.script_bedroom_lights_full
  - metadata: {}
    data: {}
    target:
      entity_id:
      - input_boolean.boolean_wakeup_lights
    action: input_boolean.turn_on
  mode: single
- id: '1741088287959'
  alias: automation-lights-remote
  description: ''
  triggers:
  - device_id: 7e0df21fba2ff631d282063e7bc97f81
    domain: zha
    type: remote_button_short_press
    subtype: turn_on
    trigger: device
    id: 'on'
  - device_id: 7e0df21fba2ff631d282063e7bc97f81
    domain: zha
    type: remote_button_short_press
    subtype: left
    trigger: device
    id: left
  - device_id: 7e0df21fba2ff631d282063e7bc97f81
    domain: zha
    type: remote_button_short_press
    subtype: right
    trigger: device
    id: right
  - device_id: 7e0df21fba2ff631d282063e7bc97f81
    domain: zha
    type: remote_button_short_press
    subtype: turn_off
    trigger: device
    id: 'off'
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_text.text_bedroom_lights_state
        state: Full
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          transition: 1
      target:
        entity_id:
        - script.script_bedroom_lights_full
  - if:
    - condition: trigger
      id:
      - left
    - condition: not
      conditions:
      - condition: state
        entity_id: input_text.text_bedroom_lights_state
        state: Partial
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          transition: 1
      target:
        entity_id:
        - script.script_bedroom_lights_partial
  - if:
    - condition: trigger
      id:
      - right
    - condition: not
      conditions:
      - condition: state
        entity_id: input_text.text_bedroom_lights_state
        state: Color
    then:
    - action: script.turn_on
      metadata: {}
      data:
        variables:
          transition: 1
      target:
        entity_id:
        - script.script_bedroom_lights_color
  - if:
    - condition: trigger
      id:
      - 'off'
    - condition: state
      entity_id: light.lights_bedroom
      state: 'on'
    then:
    - action: light.turn_off
      metadata: {}
      data: {}
      target:
        entity_id:
        - light.lights_bedroom
  mode: single
- id: '1741088398150'
  alias: automation-lights-morning-wakeup-time
  description: ''
  triggers:
  - entity_id:
    - sensor.pixel_8_next_alarm
    trigger: state
    id: phone
  - entity_id:
    - input_datetime.datetime_alarm_time
    trigger: state
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - phone
    - condition: state
      entity_id: input_boolean.boolean_wakeup_lights
      state: 'on'
    - condition: not
      conditions:
      - condition: state
        entity_id: sensor.pixel_8_next_alarm
        state: unavailable
    then:
    - stop: ''
    enabled: false
  - if:
    - condition: template
      value_template: '{{ states(''sensor.pixel_8_next_alarm'') in ["unknown","unavailable"]
        }}'
    then:
    - metadata: {}
      data:
        datetime: '{{ today_at(states(''input_datetime.datetime_alarm_time'')) - timedelta(minutes=15)
          }}'
      target:
        entity_id:
        - input_datetime.datetime_wakeup_time
      action: input_datetime.set_datetime
    else:
    - metadata: {}
      data:
        datetime: '{{ as_local(as_datetime(states(''sensor.pixel_8_next_alarm''))
          - timedelta(minutes=15)) }}'
      target:
        entity_id:
        - input_datetime.datetime_wakeup_time
      action: input_datetime.set_datetime
  mode: single
- id: '1741088451864'
  alias: automation-lights-morning-wakeup-boolean
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bed_presence_c1761c_bed_occupied_either
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    enabled: false
  - trigger: time
    at: 00:00:00
  conditions:
  - condition: state
    entity_id: input_boolean.boolean_wakeup_lights
    state: 'on'
  actions:
  - action: input_boolean.turn_off
    metadata: {}
    data: {}
    target:
      entity_id:
      - input_boolean.boolean_wakeup_lights
  mode: single
- id: '1744135981096'
  alias: automation-lights-livingroom
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.sensor_livingroom_motion
    to: 'on'
    id: turn-on-motion
    from: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.sensor_livingroom_motion
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: turn-off
    from: 'on'
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_livingroom_beam_illuminance
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 0
    id: turn-off
    value_template: '{{ state.state|float - states(''input_number.number_illumination_livingroom_dim'')|float
      - states(''input_number.number_illumination_offset'')|int }}'
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_livingroom_beam_illuminance
    below: input_number.number_illumination_livingroom_dim
    id: turn-on-illum
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_livingroom_beam_illuminance
    id: turn-on-illum
    above: 0
    for:
      hours: 0
      minutes: 0
      seconds: 40
    value_template: '{{ state.state|float - states(''input_number.number_illumination_livingroom_dark'')|float
      - states(''input_number.number_illumination_offset'')|int }}'
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_livingroom_beam_illuminance
    below: input_number.number_illumination_livingroom_dark
    id: turn-on-illum
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - turn-on-motion
      - turn-on-illum
    - condition: numeric_state
      entity_id: sensor.sensor_livingroom_beam_illuminance
      below: input_number.number_illumination_livingroom_dim
    - condition: state
      entity_id: binary_sensor.sensor_livingroom_motion
      state: 'on'
    then:
    - choose:
      - conditions:
        - condition: or
          conditions:
          - condition: and
            conditions:
            - condition: time
              before: input_datetime.datetime_wakeup_time
              enabled: true
            - condition: state
              entity_id: input_boolean.boolean_wakeup_lights
              state: 'off'
          - condition: template
            value_template: '{% set hours = as_timestamp(states(''sensor.sun_next_dusk''))
              | timestamp_custom(''%H'') | int %}

              {% set min = as_timestamp(states(''sensor.sun_next_dusk'')) | timestamp_custom(''%M'')
              | int %}

              {% set ratio = 6/10 %}

              {{ as_timestamp(now()) | timestamp_custom(''%H:%M'') >= (((24-hours-min/60)*ratio+hours+min/60)*60*60)
              | timestamp_custom(''%H:%M'', false) }}'
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: input_text.text_livingroom_lights_state
              state: Color
          then:
          - action: script.turn_on
            metadata: {}
            data:
              variables:
                transition: '{{ 1 if trigger.id == ''turn-on-motion'' else 180 }}'
            target:
              entity_id:
              - script.script_livingroom_lights_color_2
      - conditions:
        - condition: numeric_state
          entity_id: sensor.sensor_livingroom_beam_illuminance
          above: 0
          value_template: '{{ state.state|float - states(''input_number.number_illumination_livingroom_dark'')|float
            }}'
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: input_text.text_livingroom_lights_state
              state: Partial
          then:
          - action: script.turn_on
            metadata: {}
            data:
              variables:
                transition: '{{ 1 if trigger.id == ''turn-on-motion'' else 60 }}'
            target:
              entity_id: script.script_livingroom_lights_partial
      default:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_text.text_livingroom_lights_state
            state: Full
        then:
        - action: script.turn_on
          metadata: {}
          data:
            variables:
              transition: '{{ 1 if trigger.id == ''turn-on-motion'' else 60 }}'
          target:
            entity_id: script.script_livingroom_lights_full
  - if:
    - condition: trigger
      id:
      - turn-off
    - condition: state
      entity_id: light.lights_livingroom
      state: 'on'
    then:
    - action: light.turn_off
      metadata: {}
      data:
        transition: 15
      target:
        entity_id:
        - light.lights_livingroom
  mode: single
- id: '1746198320343'
  alias: automation-lights-bedroom
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.sensor_bedroom_beam_2
    to: 'on'
    id: turn-on-motion
    from: 'off'
  - trigger: state
    entity_id:
    - binary_sensor.sensor_bedroom_motion
    to: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 0
    id: turn-off
    from: 'on'
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_bedroom_beam_illuminance
    for:
      hours: 0
      minutes: 1
      seconds: 0
    above: 0
    id: turn-off
    value_template: '{{ state.state|float - states(''input_number.number_illumination_bedroom_dim'')|float
      - states(''input_number.number_illumination_offset'')|int }}'
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_bedroom_beam_illuminance
    below: input_number.number_illumination_bedroom_dim
    id: turn-on-illum
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_bedroom_beam_illuminance
    for:
      hours: 0
      minutes: 0
      seconds: 40
    above: 0
    id: turn-on-illum
    value_template: '{{ state.state|float - states(''input_number.number_illumination_bedroom_dark'')|float
      - states(''input_number.number_illumination_offset'')|int }}'
  - trigger: numeric_state
    entity_id:
    - sensor.sensor_bedroom_beam_illuminance
    below: input_number.number_illumination_bedroom_dark
    id: turn-on-illum
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - turn-on-motion
      - turn-on-illum
    - condition: numeric_state
      entity_id: sensor.sensor_bedroom_beam_illuminance
      below: input_number.number_illumination_bedroom_dim
    - condition: state
      entity_id: binary_sensor.sensor_bedroom_motion
      state: 'on'
    - condition: state
      entity_id: binary_sensor.bed_presence_c1761c_bed_occupied_either
      state: 'off'
    then:
    - choose:
      - conditions:
        - condition: time
          before: input_datetime.datetime_wakeup_time
          enabled: true
        - condition: state
          entity_id: input_boolean.boolean_wakeup_lights
          state: 'off'
        sequence: []
      - conditions:
        - condition: template
          value_template: '{% set hours = as_timestamp(states(''sensor.sun_next_dusk''))
            | timestamp_custom(''%H'') | int %}

            {% set min = as_timestamp(states(''sensor.sun_next_dusk'')) | timestamp_custom(''%M'')
            | int %}

            {% set ratio = 6/10 %}

            {{ as_timestamp(now()) | timestamp_custom(''%H:%M'') >= (((24-hours-min/60)*ratio+hours+min/60)*60*60)
            | timestamp_custom(''%H:%M'', false) }}'
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: input_text.text_bedroom_lights_state
              state: Color
          then:
          - action: script.turn_on
            metadata: {}
            data:
              variables:
                transition: '{{ 1 if trigger.id == ''turn-on-motion'' else 180 }}'
            target:
              entity_id:
              - script.script_bedroom_lights_color
      - conditions:
        - condition: numeric_state
          entity_id: sensor.sensor_bedroom_beam_illuminance
          value_template: '{{ state.state|float - states(''input_number.number_illumination_bedroom_dark'')|float
            }}'
          above: 0
        sequence:
        - if:
          - condition: not
            conditions:
            - condition: state
              entity_id: input_text.text_bedroom_lights_state
              state: Partial
          then:
          - action: script.turn_on
            metadata: {}
            data:
              variables:
                transition: '{{ 1 if trigger.id == ''turn-on-motion'' else 60 }}'
            target:
              entity_id:
              - script.script_bedroom_lights_partial
      default:
      - if:
        - condition: not
          conditions:
          - condition: state
            entity_id: input_text.text_bedroom_lights_state
            state: Full
        then:
        - action: script.turn_on
          metadata: {}
          data:
            variables:
              transition: '{{ 1 if trigger.id == ''turn-on-motion'' else 60 }}'
          target:
            entity_id:
            - script.script_bedroom_lights_full
  - if:
    - condition: trigger
      id:
      - turn-off
    - condition: state
      entity_id: light.lights_bedroom
      state: 'on'
    then:
    - action: light.turn_off
      metadata: {}
      data:
        transition: 15
      target:
        entity_id: light.lights_bedroom
  mode: single
- id: '1746824071284'
  alias: automation-lights-off
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - light.lights_livingroom
    id: living
    to: 'off'
    from: 'on'
  - trigger: state
    entity_id:
    - light.lights_bedroom
    id: bed
    to: 'off'
    from: 'on'
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - living
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: 'Off'
      target:
        entity_id: input_text.text_livingroom_lights_state
  - if:
    - condition: trigger
      id:
      - bed
    then:
    - action: input_text.set_value
      metadata: {}
      data:
        value: 'Off'
      target:
        entity_id: input_text.text_bedroom_lights_state
  mode: single
- id: '1754048616434'
  alias: automation-lights-kitchen
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.sensor_kitchen_countertop
    from: 'off'
    to: 'on'
    id: 'on'
  - trigger: state
    entity_id:
    - binary_sensor.sensor_kitchen_countertop
    from: 'on'
    to: 'off'
    id: 'off'
    for:
      hours: 0
      minutes: 1
      seconds: 30
  conditions: []
  actions:
  - if:
    - condition: trigger
      id:
      - 'on'
    - condition: state
      entity_id: light.light_kitchen_countertop
      state: 'off'
    - condition: numeric_state
      entity_id: sensor.sensor_livingroom_beam_illuminance
      below: input_number.number_illumination_livingroom_dim
    then:
    - action: light.turn_on
      metadata: {}
      data:
        brightness_pct: 90
        transition: 0.6
      target:
        entity_id:
        - light.light_kitchen_countertop
  - if:
    - condition: trigger
      id:
      - 'off'
    - condition: not
      conditions:
      - condition: state
        entity_id: input_text.text_livingroom_lights_state
        state: Color
    then:
    - action: light.turn_off
      metadata: {}
      data:
        transition: 0.6
      target:
        entity_id:
        - light.light_kitchen_countertop
  mode: single
- id: '1755073810210'
  alias: automation-lights-bedroom-bed
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - binary_sensor.bed_presence_c1761c_bed_occupied_either
    from: 'off'
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 45
  conditions: []
  actions:
  - if:
    - condition: state
      entity_id: light.lights_bedroom
      state: 'on'
    then:
    - action: light.turn_off
      metadata: {}
      data:
        transition: 15
      target:
        entity_id: light.lights_bedroom
  - if:
    - condition: state
      entity_id: light.lights_livingroom
      state: 'on'
    then:
    - action: light.turn_off
      metadata: {}
      data:
        transition: 15
      target:
        entity_id:
        - light.lights_livingroom
  mode: single
- id: '1756149421208'
  alias: automation-utilities-outlierdetection
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.template_electricity_zscore
    - sensor.template_gas_zscore
    - sensor.template_water_zscore
    above: 3
  conditions: []
  actions:
  - repeat:
      count: 5
      sequence:
      - action: notify.notify
        metadata: {}
        data:
          message: HIGH Z-SCORE - {{ state_attr(trigger.entity_id, 'friendly_name')
            | replace('template-','') | upper }} ({{ states(trigger.entity_id) | round(2)
            }})
      - delay:
          hours: 0
          minutes: 1
          seconds: 0
          milliseconds: 0
  mode: single
- id: '1756333906395'
  alias: automation-utilities-outliers
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.watermeter_total_water_usage
    above: sensor.template_water_iqr_high
  - trigger: numeric_state
    entity_id:
    - sensor.p1_meter_energy_import
    above: sensor.template_electricity_iqr_high
  - trigger: numeric_state
    entity_id:
    - sensor.gas_meter_gas
    above: sensor.template_gas_iqr_high
  conditions: []
  actions:
  - repeat:
      count: 5
      sequence:
      - action: notify.notify
        metadata: {}
        data:
          message: HIGH IQR - {{ state_attr(trigger.entity_id, 'friendly_name') |
            upper }} ({{ states(trigger.entity_id) | round(2) }})
      - delay:
          hours: 0
          minutes: 1
          seconds: 0
          milliseconds: 0
  mode: single
- id: '1756729834801'
  alias: automation-utilities-mad-fences
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.p1_meter_energy_import
    above: sensor.template_electricity_mad_upperfence
    id: fence
  - trigger: numeric_state
    entity_id:
    - sensor.gas_meter_gas
    above: sensor.template_gas_mad_upperfence
    id: fence
  - trigger: numeric_state
    entity_id:
    - sensor.watermeter_total_water_usage
    above: sensor.template_water_mad_upperfence
    id: fence
  - trigger: numeric_state
    entity_id:
    - sensor.statistics_electricity_mad_score
    - sensor.statistics_gas_mad_score
    - sensor.statistics_water_mad_score
    above: 3
    id: score
  conditions: []
  actions:
  - repeat:
      count: 5
      sequence:
      - choose:
        - conditions:
          - condition: trigger
            id:
            - fence
          sequence:
          - action: notify.notify
            metadata: {}
            data:
              message: MAD fence - {{ state_attr(trigger.entity_id, 'friendly_name')
                | upper }} ({{ states(trigger.entity_id) | round(2) }})
        - conditions:
          - condition: trigger
            id:
            - score
          sequence:
          - action: notify.notify
            metadata: {}
            data:
              message: MAD score - {{ state_attr(trigger.entity_id, 'friendly_name')
                | upper }} ({{ states(trigger.entity_id) | round(2) }})
      - delay:
          hours: 0
          minutes: 1
          seconds: 0
          milliseconds: 0
  mode: single
- id: '1757589692951'
  alias: automation-receiver-source
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.philips_43pus8506_2
    to: 'on'
    for:
      hours: 0
      minutes: 0
      seconds: 1
  conditions:
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.philips_43pus8506_2
      state: com.google.android.tvlauncher
      attribute: app_id
  - condition: template
    value_template: '{{ state_attr(''media_player.denon_dra_800h'',''source'') not
      in ["TV Audio", None] }}'
  actions:
  - action: media_player.select_source
    metadata: {}
    data:
      source: TV Audio
    target:
      entity_id: media_player.denon_dra_800h
  - action: notify.notify
    metadata: {}
    data:
      message: CHANGE SOURCE
  mode: single
- id: '1757589732533'
  alias: automation-chromecast-off
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.philips_43pus8506_2
    from: 'on'
    to: 'off'
    for:
      hours: 0
      minutes: 0
      seconds: 2
  conditions:
  - condition: template
    value_template: '{{ state_attr(''media_player.philips_43pus8506'',''app_id'')
      != None }}'
  actions:
  - action: media_player.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: media_player.philips_43pus8506
  - action: notify.notify
    metadata: {}
    data:
      message: CHROMECAST OFF
  mode: single
- id: '1757589773828'
  alias: automation-tv-off
  description: ''
  triggers:
  - trigger: state
    entity_id:
    - media_player.philips_43pus8506
    to: idle
    for:
      hours: 0
      minutes: 15
      seconds: 0
  - trigger: state
    entity_id:
    - media_player.philips_43pus8506_2
    attribute: app_id
    to: com.google.android.tvlauncher
    for:
      hours: 0
      minutes: 10
      seconds: 0
  conditions:
  - condition: state
    entity_id: media_player.philips_43pus8506_2
    state: 'on'
  actions:
  - action: media_player.turn_off
    metadata: {}
    data: {}
    target:
      entity_id: media_player.philips_43pus8506_2
  - action: notify.notify
    metadata: {}
    data:
      message: TV OFF
  mode: single
